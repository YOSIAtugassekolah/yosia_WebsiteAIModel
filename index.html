<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Detector - Yosia</title>

<!-- TensorFlow & Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
}
.container {
    background: white;
    padding: 20px;
    max-width: 420px;
    width: 90%;
    border-radius: 16px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,.2);
}
button {
    background: #667eea;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 20px;
    cursor: pointer;
    margin: 5px;
}
button:hover { opacity: .9; }

#webcam-container, img {
    margin-top: 10px;
    border-radius: 10px;
    width: 100%;
}

.prediction-bar {
    background: #eee;
    border-radius: 8px;
    margin-top: 8px;
    height: 26px;
    position: relative;
    overflow: hidden;
}
.bar-fill {
    height: 100%;
    width: 0%;
    background: #764ba2;
    transition: width .3s;
}
.bar-text {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 13px;
    font-weight: bold;
}
footer {
    font-size: 12px;
    color: #777;
    margin-top: 15px;
}
</style>
</head>

<body>
<div class="container">
    <h2>AI Detector</h2>
    <p>Webcam & Upload Image</p>

    <button onclick="startWebcam()">ðŸŽ¥ Kamera</button>
    <input type="file" accept="image/*" onchange="predictUpload(event)">

    <div id="webcam-container"></div>
    <img id="preview">

    <div id="label-container"></div>

    <footer>
        Dibuat oleh <b>Yosia Edmund Herlianto</b><br>
        Project AI
    </footer>
</div>

<script>
const MODEL_URL = "https://teachablemachine.withgoogle.com/models/NWKfrLufm/";

let model, webcam, maxPredictions;

async function loadModel() {
    model = await tmImage.load(
        MODEL_URL + "model.json",
        MODEL_URL + "metadata.json"
    );
    maxPredictions = model.getTotalClasses();

    const labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";
    for (let i = 0; i < maxPredictions; i++) {
        labelContainer.innerHTML += `
        <div class="prediction-bar">
            <div class="bar-fill" id="bar-${i}"></div>
            <div class="bar-text" id="text-${i}">-</div>
        </div>`;
    }
}
loadModel();

// ===== WEBCAM =====
async function startWebcam() {
    webcam = new tmImage.Webcam(300, 300, true);
    await webcam.setup();
    await webcam.play();
    document.getElementById("webcam-container").innerHTML = "";
    document.getElementById("webcam-container").appendChild(webcam.canvas);
    window.requestAnimationFrame(loop);
}

async function loop() {
    webcam.update();
    await predict(webcam.canvas);
    window.requestAnimationFrame(loop);
}

// ===== UPLOAD =====
async function predictUpload(event) {
    const img = document.getElementById("preview");
    img.src = URL.createObjectURL(event.target.files[0]);
    img.onload = () => predict(img);
}

// ===== PREDICT =====
async function predict(source) {
    const prediction = await model.predict(source);
    prediction.forEach((p, i) => {
        document.getElementById(`text-${i}`).innerText =
            `${p.className} ${(p.probability*100).toFixed(0)}%`;
        document.getElementById(`bar-${i}`).style.width =
            (p.probability*100) + "%";
    });
}
</script>
</body>
</html>
